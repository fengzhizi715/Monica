# i18n 脚本使用指南

## 📖 概述

本指南介绍 i18n 模块中两个字符串资源管理脚本的使用方法：
- `string_manager.sh` - 字符串资源文件综合管理工具
- `position_check.sh` - 位置比对脚本

## 🔧 string_manager.sh - 字符串资源文件综合管理工具

### 功能特性

- ✅ 检查重复的字符串名称和内容
- ✅ 比对中英文文件差异
- ✅ 自动修复重复项
- ✅ 位置比对模式
- ✅ 详细输出和干运行模式
- ✅ 自动备份功能

### 基本语法

```bash
./string_manager.sh [选项] <文件路径>
```

### 模式选项

| 选项 | 长选项 | 功能 |
|------|--------|------|
| `-c` | `--cleanup` | 清理模式：检查并清理重复项 |
| `-m` | `--compare` | 比对模式：比对中英文文件差异 |
| `-p` | `--position` | 位置比对模式：检查相同key的行号是否一致 |
| `-a` | `--all` | 全功能模式：清理 + 比对 |

### 清理模式选项

| 选项 | 长选项 | 功能 |
|------|--------|------|
| `-v` | `--verbose` | 详细输出 |
| `-d` | `--dry-run` | 只检查，不修改文件 |
| `-n` | `--no-backup` | 不创建备份文件 |
| `-f` | `--auto-fix` | 自动修复重复项（保留第一次出现的版本） |

### 使用示例

#### 1. 查看帮助信息
```bash
./string_manager.sh --help
```

#### 2. 比对中英文文件差异
```bash
# 检查中英文文件是否同步
./string_manager.sh -m
```

**输出示例：**
```
=== 中英文字符串资源文件比对 ===

1. 提取中文文件中的字符串名称...
2. 提取英文文件中的字符串名称...
3. 统计信息...
中文文件字符串数量:      366
英文文件字符串数量:      366

4. 中文有但英文没有的字符串:
✅ 没有缺失的英文翻译

5. 英文有但中文没有的字符串:
✅ 没有缺失的中文翻译

=== 比对完成 ===
```

#### 3. 检查重复项（不修改文件）
```bash
# 干运行模式，只检查不修改
./string_manager.sh -c -d
```

**输出示例：**
```
字符串资源文件清理工具 v2.0

处理文件: src/main/resources/strings/strings_zh.xml
==================================
=== 文件统计报告 ===
文件: src/main/resources/strings/strings_zh.xml
总行数:           470
字符串总数: 366
唯一字符串名称:           366
重复字符串名称:        0

✓ 没有发现重复的字符串名称
发现 31 个重复的字符串内容:
人脸替换
人脸检测
伽马变换
...
处理完成！
```

#### 4. 自动修复重复项
```bash
# 自动修复重复项，保留第一次出现的版本
./string_manager.sh -c -f
```

#### 5. 详细检查模式
```bash
# 详细输出，显示重复项的详细信息
./string_manager.sh -c -v -d
```

#### 6. 全功能模式
```bash
# 清理 + 比对，自动修复
./string_manager.sh -a -f
```

#### 7. 检查特定文件
```bash
# 检查指定的文件
./string_manager.sh -c src/main/resources/strings/strings_zh.xml
```

### 输出说明

#### 文件统计报告
- **总行数**: 文件的总行数
- **字符串总数**: 包含的字符串定义数量
- **唯一字符串名称**: 不重复的字符串名称数量
- **重复字符串名称**: 重复的字符串名称数量

#### 重复项检测
- **重复字符串名称**: 相同 `name` 属性的字符串
- **重复字符串内容**: 相同内容的字符串（可能名称不同）

## 🔍 position_check.sh - 位置比对脚本

### 功能特性

- ✅ 检查中英文配置文件中相同key的行号是否一致
- ✅ 统计行号差异信息
- ✅ 提供详细的差异报告

### 基本语法

```bash
./position_check.sh
```

### 使用示例

#### 检查行号一致性
```bash
./position_check.sh
```

**输出示例：**
```
=== 中英文字符串资源文件位置比对 ===

1. 提取中文文件中的key和行号...
2. 提取英文文件中的key和行号...
3. 统计信息...
中文文件字符串数量: 366
英文文件字符串数量: 366

4. 共同key数量: 366

5. 检查行号一致性...
行号不匹配: adaptive_threshold_algorithm
  中文文件第288行
  英文文件第435行
  差异: -147 行

行号不匹配: adaptive_threshold_cancelled
  中文文件第446行
  英文文件第421行
  差异: 25 行

...

6. 位置比对结果:
⚠️  发现      349 个key的行号不一致
  最大行号差异: 443 行
  平均行号差异: 53.3 行

=== 位置比对完成 ===
```

### 输出说明

#### 统计信息
- **中文文件字符串数量**: 中文文件中的字符串总数
- **英文文件字符串数量**: 英文文件中的字符串总数
- **共同key数量**: 两个文件都包含的字符串数量

#### 行号差异
- **行号不匹配**: 相同key在不同文件中的行号不同
- **差异**: 行号差值（正数表示中文文件行号更大，负数表示英文文件行号更大）

#### 比对结果
- **不匹配数量**: 行号不一致的key数量
- **最大行号差异**: 最大的行号差值
- **平均行号差异**: 平均的行号差值

## 🚀 常见使用场景

### 场景1：日常维护检查
```bash
# 检查文件是否同步
./string_manager.sh -m

# 检查是否有重复项
./string_manager.sh -c -d
```

### 场景2：修复重复项
```bash
# 先检查重复项
./string_manager.sh -c -v -d

# 确认后自动修复
./string_manager.sh -c -f
```

### 场景3：全面检查
```bash
# 全功能检查
./string_manager.sh -a -f

# 检查行号一致性
./position_check.sh
```

### 场景4：开发新功能后
```bash
# 添加新字符串后，检查同步性
./string_manager.sh -m

# 检查是否有重复
./string_manager.sh -c -d
```

## ⚠️ 注意事项

### 备份建议
- 使用 `-f` 选项自动修复前，建议先运行 `-d` 选项检查
- 脚本会自动创建备份文件（除非使用 `-n` 选项）
- 备份文件格式：`原文件名.backup.时间戳`

### 文件路径
- 脚本默认使用 `src/main/resources/strings/` 目录下的文件
- 可以指定其他文件路径作为参数
- 确保文件路径正确且文件存在

### 权限要求
- 脚本需要执行权限：`chmod +x string_manager.sh position_check.sh`
- 修改文件需要写入权限

## 🔧 故障排除

### 常见错误

#### 1. 权限错误
```bash
# 解决方案：添加执行权限
chmod +x string_manager.sh position_check.sh
```

#### 2. 文件不存在
```bash
# 检查文件路径
ls -la src/main/resources/strings/
```

#### 3. 语法错误
```bash
# 检查脚本语法
bash -n string_manager.sh
bash -n position_check.sh
```

### 调试技巧

#### 1. 详细输出
```bash
# 使用 -v 选项查看详细信息
./string_manager.sh -c -v -d
```

#### 2. 干运行模式
```bash
# 使用 -d 选项不修改文件
./string_manager.sh -c -d
```

#### 3. 检查特定文件
```bash
# 指定文件路径
./string_manager.sh -c /path/to/your/file.xml
```

## 📚 相关文档

- [i18n 模块 README](README.md)
- [字符串管理指南](I18N_STRING_MANAGEMENT_GUIDE.md)
- [国际化测试文档](src/test/kotlin/cn/netdiscovery/monica/i18n/InternationalizationTest.kt)

## 🤝 贡献指南

如果你发现脚本的问题或有改进建议，请：

1. 检查脚本语法：`bash -n script_name.sh`
2. 测试功能：使用 `-d` 选项进行干运行
3. 提交问题或改进建议

---

**最后更新**: 2024年12月
**版本**: 2.0
**维护者**: AI Assistant
